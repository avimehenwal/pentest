#!/bin/zsh

TITLE="Vulnerable environments for pentesting"
SUB_TITLE="Choose practise environment to start hacking"

APP_PORT=8888
DELAY=12

SELECTION=$(whiptail --title ${TITLE} --radiolist ${SUB_TITLE} 20 100 5 \
"WEB_GOAT" "webgoat/webgoat" OFF \
"DVWA" "vulnerables/web-dvwa" OFF \
"bWAPP" "hackersploit/bwapp-docker" ON \
3>&1 1>&2 2>&3 )

case $SELECTION in
  WEB_GOAT)
    docker run --rm -d -p ${APP_PORT}:8080 -p 9999:9090 --name ${SELECTION} webgoat/webgoat
    sleep ${DELAY} && open "http://localhost:${APP_PORT}/WebGoat"
    ;;

  DVWA)
    docker run --rm -d -p ${APP_PORT}:80 --name ${SELECTION} vulnerables/web-dvwa
    sleep ${DELAY} && open "http://localhost:${APP_PORT}"
    ;;
  
  bWAPP)
    docker run --rm -d -p ${APP_PORT}:80 --name ${SELECTION} hackersploit/bwapp-docker
    sleep ${DELAY} && open "http://localhost:${APP_PORT}/install.php"
    ;;

  *)
    echo "cancel - no selection"
    ;;
esac

trap ctrl_c INT

function ctrl_c() {
  echo ""
  toilet -t -f wideterm -f pagga --filter crop:border " stop  ${SELECTION} "
  docker stop ${SELECTION}
}

docker logs --follow ${SELECTION}
